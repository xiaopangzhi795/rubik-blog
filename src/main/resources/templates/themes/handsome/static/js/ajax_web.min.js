$('#easyLogin').delegate('#Login_form',"submit",function(){//登录ajax
    $("#login-submit").attr('disabled', true).fadeTo('slow', 0.5);
    var user = $('#navbar-login-user').val();
    var userpassword = $('#navbar-login-password').val();
    if (user == "") {
        toastr.error(UsernameInfo);
        $("#navbar-login-user").focus();
        error_action();
        return false;
    }
    if (userpassword == "") {
        toastr.error(passwordInfo);
        $("#navbar-login-password").focus();
        error_action();
        return false;
    }
    $('#login-submit').addClass("active");
    $('#spin-login').addClass("show inline");
    $.ajax({
        url: $(this).attr('action'),//提交表form的action属性
        type: $(this).attr('method'),//提交表form的method属性
        data: $(this).serializeArray(),//要发送到服务器的数据
        error: function() {
            toastr.error(loginError);
            error_action();
            return false;
        },
        success: function(data) {
            //console.log("发送到服务器数据" + $(this).serializeArray());
            $('#login-submit').removeClass("active");
            $('#spin-login').removeClass("show inline");
            try{
                if ($('#Logged-in',data).length<=0){
                    toastr.error(login_info_Eroor);
                    error_action();
                    return false;
                }
                data = $('#easyLogin',data).html();
                $('#easyLogin').html(data);
                toastr.success(login_sucess);
            }catch(e){
                alert("error!" + "\n" + e);
            }
        } // end success
    }) // end ajax
    return false;
}) //end login

$('#easyLogin').delegate('#sign_out',"click",function(){//注销ajax
    $.ajax({
        url: $(this).attr('href'),//提交表form的action属性
        data: {},
        error: function(XMLHttpRequest, textStatus, errorThrow) {
            // console.log(XMLHttpRequest.status);
            // console.log(XMLHttpRequest.readyState);
            // console.log(textStatus);
            toastr.success(logout_sucess_refresh);
            window.location.reload();
            return false;
        },
        success: function(data) {
            try{
                if ($('#Login_form',data).length <=0 ){
                    toastr.error(logout_error);
                    return false;
                }
                data = $('#easyLogin',data).html();
                $('#easyLogin').html(data);
                toastr.success(logout_sucess);
            }catch (e){
                alert("Error!" + e);
            }

        }// end success
    }) //end ajax
    return false;
});

function error_action() { // 出错
    $('#login-submit').attr('disabled', false).fadeTo('', 1);
}

$('form.protected').submit(function () {//加密文章提交ajax
    $.ajax({
        url: $(this).attr('action'),//提交表form的action属性
        type: $(this).attr('method'),//提交表form的method属性
        data: $(this).serializeArray(),//要发送到服务器的数据
        error: function () {
            toastr.error(submitError);
            return false;
        },
        success: function (data) {
            try{
                if ($('#post-content',data).length<=0){
                    toastr.error(password_post_error);
                    return false;
                }
                var postContent = $('#post-content',data).html();
                var commentContent = $('#comments',data).html();
                var postTitle = $('#small_widgets h1',data).html();
                $('#post-content').html(postContent);
                $('#comments').html(commentContent);
                $('#small_widgets h1').html(postTitle);
            }catch (e){
                window.location.reload();
            }
        }
    })
    return false;
})

$('#searchform').submit(function () {
    var searchUrlValue = $(this).attr('action') + $('#keyword').val() + "/";
    $("#searchUrl").attr("href",searchUrlValue);
    document.getElementById("searchUrl").click();
    return false;
})